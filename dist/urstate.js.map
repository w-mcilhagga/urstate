{"version":3,"sources":["dist/urstate.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","urstate","state","onSet","now","ur","undefined","root","undo","moveto","back","redo","forward","can","$","path","concat","parsepath","$$","save","slice","fragment","this","get","deepcopy","getfragment","set","v","setfragment","merge","Object","assign","split","filter","node","reduce","step","value","obj","toType","map","keys","d","k","toString","match","toLowerCase"],"mappings":"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","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n'use strict';\n\n// undo/redo implemented on an object\nmodule.exports = function urstate(state, onSet) {\n\tvar now = {},\n\t    ur;\n\n\tonSet = onSet || function () {\n\t\treturn undefined;\n\t};\n\tstate = { root: state };\n\tur = {\n\t\tundo: function undo() {\n\t\t\treturn moveto(now.back);\n\t\t},\n\t\tredo: function redo() {\n\t\t\treturn moveto(now.forward);\n\t\t},\n\t\tcan: {\n\t\t\tundo: function undo() {\n\t\t\t\treturn !!now.back;\n\t\t\t},\n\t\t\tredo: function redo() {\n\t\t\t\treturn !!now.forward;\n\t\t\t}\n\t\t}\n\t};\n\n\tfunction $(path) {\n\t\tpath = ['root'].concat(parsepath(path));\n\n\t\tvar $$ = {\n\t\t\tsave: function save() {\n\t\t\t\tnow.path = path.slice();\n\t\t\t\tnow.fragment = this.get();\n\t\t\t\tnow.forward = { back: now };\n\t\t\t\tnow = now.forward;\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tget: function get() {\n\t\t\t\treturn deepcopy(getfragment(state, path));\n\t\t\t},\n\t\t\tset: function set(v) {\n\t\t\t\tsetfragment(state, path, v);\n\t\t\t\tonSet(path);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tmerge: function merge(v) {\n\t\t\t\tObject.assign(getfragment(state, path), v);\n\t\t\t\tonSet(path);\n\t\t\t\treturn this;\n\t\t\t}\n\t\t};\n\n\t\tObject.assign($, ur);\n\t\tObject.assign($$, ur);\n\n\t\treturn $$;\n\t}\n\n\treturn $;\n\n\tfunction parsepath(path) {\n\t\tpath = path || [];\n\t\treturn typeof path === 'string' ? path.split(/\\.|\\[|\\]/).filter(function (i) {\n\t\t\treturn i !== \"\";\n\t\t}) : path.slice();\n\t}\n\n\tfunction moveto(node) {\n\t\tif (node) {\n\t\t\tnow.path = node.path;\n\t\t\tnow.fragment = getfragment(state, node.path);\n\t\t\tsetfragment(state, node.path, node.fragment);\n\t\t\tdelete node.path;\n\t\t\tdelete node.fragment;\n\t\t\tnow = node;\n\t\t}\n\t}\n\n\tfunction getfragment(state, path) {\n\t\treturn path.reduce(function (s, step) {\n\t\t\treturn s[step];\n\t\t}, state);\n\t}\n\n\tfunction setfragment(state, path, value) {\n\t\tvar s = getfragment(state, path.slice(0, -1));\n\t\ts[path.slice(-1)[0]] = value;\n\t}\n\n\tfunction deepcopy(obj) {\n\t\tswitch (toType(obj)) {\n\t\t\tcase 'array':\n\t\t\t\treturn obj.map(function (v) {\n\t\t\t\t\treturn deepcopy(v);\n\t\t\t\t});\n\t\t\tcase 'object':\n\t\t\t\treturn Object.keys(obj).reduce(function (d, k) {\n\t\t\t\t\td[k] = deepcopy(obj[k]);\n\t\t\t\t\treturn d;\n\t\t\t\t}, {});\n\t\t\tdefault:\n\t\t\t\treturn obj;\n\t\t}\n\t}\n\n\tfunction toType(obj) {\n\t\treturn {}.toString.call(obj).match(/\\s([a-zA-Z]+)/)[1].toLowerCase();\n\t}\n};\n\n},{}]},{},[1]);\n"]}